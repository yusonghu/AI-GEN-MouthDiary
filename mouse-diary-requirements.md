# 小鼠日记本 - 需求文档

## 1. 项目概述

### 1.1 项目名称
小鼠日记本 (Mouse Diary)

### 1.2 项目目标
为实验室研究人员提供一个简洁、专业的小鼠实验记录管理系统，支持实验数据的录入、查询、统计和导出。

### 1.3 目标用户
- 实验室研究人员
- 动物实验技术员
- 实验室管理人员

---

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 小鼠管理
- **添加小鼠**：录入小鼠基本信息
- **编辑小鼠**：修改小鼠信息
- **删除小鼠**：移除小鼠记录（软删除）
- **小鼠列表**：查看所有小鼠，支持搜索和筛选
- **小鼠详情**：查看单只小鼠的完整信息和所有实验记录

#### 2.1.2 实验记录
- **添加实验记录**：为指定小鼠添加实验数据
- **编辑实验记录**：修改已有记录
- **删除实验记录**：删除实验记录
- **批量添加**：支持批量录入多只小鼠的实验数据

#### 2.1.3 数据查询与统计
- **按日期查询**：查看指定日期范围内的实验记录
- **按小鼠查询**：查看单只小鼠的所有记录
- **按实验类型筛选**：按实验项目筛选记录
- **数据统计**：统计实验次数、小鼠数量等基础数据

#### 2.1.4 数据导出
- **导出Excel**：导出实验记录为Excel文件
- **导出PDF报告**：生成实验报告PDF
- **选择性导出**：支持按条件筛选后导出

---

## 3. 数据结构设计

### 3.1 小鼠信息表 (mice)

| 字段名 | 类型 | 说明 | 必填 |
|--------|------|------|------|
| id | INT | 主键，自增 | 是 |
| mouse_code | VARCHAR(20) | 小鼠编号（唯一标识） | 是 |
| strain | VARCHAR(50) | 品系（如：C57BL/6） | 是 |
| gender | ENUM | 性别（M/F） | 是 |
| birth_date | DATE | 出生日期 | 是 |
| source | VARCHAR(100) | 来源/供应商 | 否 |
| cage_number | VARCHAR(20) | 笼位号 | 否 |
| status | ENUM | 状态（存活/死亡/淘汰） | 是，默认：存活 |
| notes | TEXT | 备注 | 否 |
| created_at | DATETIME | 创建时间 | 是 |
| updated_at | DATETIME | 更新时间 | 是 |

### 3.2 实验记录表 (experiments)

| 字段名 | 类型 | 说明 | 必填 |
|--------|------|------|------|
| id | INT | 主键，自增 | 是 |
| mouse_id | INT | 关联小鼠ID（外键） | 是 |
| experiment_date | DATE | 实验日期 | 是 |
| experiment_type | VARCHAR(50) | 实验类型（如：称重、给药、行为测试等） | 是 |
| weight | DECIMAL(5,2) | 体重（克） | 否 |
| temperature | DECIMAL(4,1) | 体温（℃） | 否 |
| behavior_notes | TEXT | 行为观察记录 | 否 |
| medication | VARCHAR(200) | 用药记录 | 否 |
| dosage | VARCHAR(50) | 剂量 | 否 |
| route | VARCHAR(20) | 给药途径（口服/注射等） | 否 |
| results | TEXT | 实验结果 | 否 |
| abnormalities | TEXT | 异常情况 | 否 |
| operator | VARCHAR(50) | 操作人 | 否 |
| created_at | DATETIME | 创建时间 | 是 |
| updated_at | DATETIME | 更新时间 | 是 |

---

## 4. 页面设计

### 4.1 整体风格
- **主色调**：实验室蓝 (#2196F3) + 白色
- **辅助色**：浅灰 (#F5F5F5)、深灰 (#424242)
- **字体**：系统默认无衬线字体
- **布局**：简洁明了，留白充足

### 4.2 页面结构

#### 4.2.1 导航栏（顶部固定）
- Logo：小鼠日记本
- 导航项：小鼠管理 | 实验记录 | 数据统计 | 导出数据
- 风格：白色背景，蓝色下划线指示当前页面

#### 4.2.2 首页/仪表盘
- 快速统计卡片：
  - 当前存活小鼠数量
  - 今日实验记录数
  - 本周实验次数
  - 本月新增小鼠
- 快捷操作按钮：
  - 添加小鼠
  - 添加实验记录
- 最近实验记录列表（最近10条）

#### 4.2.3 小鼠管理页
- 搜索栏：按编号、品系、笼位搜索
- 筛选器：按状态、性别筛选
- 小鼠列表表格：
  - 列：编号、品系、性别、出生日期、年龄、状态、笼位、操作
  - 操作按钮：查看详情 | 编辑 | 删除
- 分页：每页20条
- 顶部按钮：添加小鼠

#### 4.2.4 小鼠详情页
- 基本信息卡片：显示小鼠所有基本信息
- 实验记录时间轴：按日期倒序显示所有实验记录
- 体重变化图表：折线图展示体重变化趋势
- 操作按钮：编辑信息 | 添加实验记录 | 返回列表

#### 4.2.5 添加/编辑小鼠页
- 表单字段：
  - 小鼠编号（文本输入）
  - 品系（下拉选择：C57BL/6、BALB/c、SD等常见品系 + 自定义输入）
  - 性别（单选：雄性/雌性）
  - 出生日期（日期选择器）
  - 来源（文本输入）
  - 笼位号（文本输入）
  - 备注（多行文本）
- 按钮：保存 | 取消

#### 4.2.6 实验记录页
- 搜索筛选栏：
  - 日期范围选择
  - 小鼠编号搜索
  - 实验类型筛选
- 实验记录列表表格：
  - 列：日期、小鼠编号、实验类型、体重、操作人、操作
  - 操作按钮：查看详情 | 编辑 | 删除
- 批量操作：选择多条记录后批量删除
- 分页：每页20条
- 顶部按钮：添加实验记录

#### 4.2.7 添加/编辑实验记录页
- 表单字段：
  - 选择小鼠（下拉选择或搜索）
  - 实验日期（日期选择器，默认今天）
  - 实验类型（下拉选择：称重、给药、行为测试、采血、解剖等）
  - 体重（数字输入，单位：克）
  - 体温（数字输入，单位：℃）
  - 行为观察（多行文本）
  - 用药记录（文本输入）
  - 剂量（文本输入）
  - 给药途径（下拉选择：口服、皮下注射、腹腔注射、静脉注射等）
  - 实验结果（多行文本）
  - 异常情况（多行文本）
  - 操作人（文本输入）
- 按钮：保存 | 保存并继续添加 | 取消

#### 4.2.8 数据统计页
- 统计卡片：
  - 总小鼠数 / 存活数 / 死亡数
  - 本月实验次数
  - 各品系小鼠分布（饼图）
  - 各性别比例（饼图）
- 实验类型分布（柱状图）
- 月度实验趋势（折线图）

#### 4.2.9 数据导出页
- 导出条件选择：
  - 日期范围
  - 小鼠筛选（全部/指定小鼠）
  - 实验类型筛选
- 导出格式选择：
  - Excel (.xlsx)
  - PDF报告 (.pdf)
- 导出按钮
- 导出历史记录（最近10次导出）

---

## 5. 技术架构

### 5.1 技术栈
- **前端**：HTML5 + CSS3 + JavaScript (原生)
- **后端**：Node.js + Express
- **数据库**：SQLite（轻量级，无需额外配置）
- **图表库**：Chart.js
- **导出库**：
  - Excel：xlsx
  - PDF：pdfkit 或 puppeteer

### 5.2 项目结构
```
mouse-diary/
├── public/              # 静态资源
│   ├── css/
│   │   └── style.css
│   ├── js/
│   │   ├── main.js
│   │   ├── mice.js
│   │   ├── experiments.js
│   │   └── charts.js
│   └── index.html
├── server/              # 后端代码
│   ├── database.js      # 数据库连接和初始化
│   ├── routes/
│   │   ├── mice.js      # 小鼠相关API
│   │   ├── experiments.js # 实验记录API
│   │   └── export.js    # 导出功能API
│   └── app.js           # Express应用主文件
├── data/                # 数据库文件
│   └── mouse_diary.db
├── package.json
└── README.md
```

### 5.3 API接口设计

#### 小鼠相关接口
- `GET /api/mice` - 获取小鼠列表（支持分页、搜索、筛选）
- `GET /api/mice/:id` - 获取单只小鼠详情
- `POST /api/mice` - 添加小鼠
- `PUT /api/mice/:id` - 更新小鼠信息
- `DELETE /api/mice/:id` - 删除小鼠

#### 实验记录相关接口
- `GET /api/experiments` - 获取实验记录列表
- `GET /api/experiments/:id` - 获取单条实验记录
- `GET /api/mice/:id/experiments` - 获取指定小鼠的所有实验记录
- `POST /api/experiments` - 添加实验记录
- `PUT /api/experiments/:id` - 更新实验记录
- `DELETE /api/experiments/:id` - 删除实验记录

#### 数据统计接口
- `GET /api/stats/overview` - 获取概览统计数据
- `GET /api/stats/strain-distribution` - 品系分布统计
- `GET /api/stats/experiment-trend` - 实验趋势统计

#### 导出接口
- `POST /api/export/excel` - 导出Excel
- `POST /api/export/pdf` - 导出PDF

---

## 6. 界面原型描述

### 6.1 整体布局
- 顶部固定导航栏（高度60px）
- 主体内容区域（白色背景，最大宽度1200px居中）
- 页面内边距：20px
- 卡片圆角：8px
- 按钮圆角：4px

### 6.2 颜色规范
- 主色：#2196F3（蓝色）
- 主色悬停：#1976D2（深蓝）
- 成功色：#4CAF50（绿色）
- 警告色：#FF9800（橙色）
- 危险色：#F44336（红色）
- 背景色：#FFFFFF（白色）
- 次要背景：#F5F5F5（浅灰）
- 边框色：#E0E0E0（灰色）
- 文字主色：#212121（深灰）
- 文字次色：#757575（中灰）

### 6.3 交互规范
- 按钮悬停：背景色变深，轻微上移阴影
- 表格行悬停：背景色变为浅灰
- 表单聚焦：边框变为主色蓝色
- 删除操作：二次确认弹窗
- 保存成功：顶部绿色提示条，2秒后自动消失
- 加载状态：按钮显示加载动画

---

## 7. 非功能性需求

### 7.1 性能要求
- 页面加载时间 < 2秒
- 列表查询响应时间 < 1秒
- 支持同时记录1000+小鼠数据

### 7.2 兼容性
- 支持Chrome、Firefox、Edge、Safari最新版本
- 响应式设计，支持平板和桌面端

### 7.3 数据安全
- 定期自动备份数据库（每天一次）
- 导出文件包含时间戳避免覆盖

### 7.4 易用性
- 所有操作3步内完成
- 表单自动保存草稿
- 支持键盘快捷键（如：Ctrl+S保存）

---

## 8. 开发计划

### 阶段一：基础框架（第1-2天）
1. 搭建Node.js + Express后端框架
2. 配置SQLite数据库
3. 创建数据库表结构
4. 搭建前端基础页面结构

### 阶段二：核心功能（第3-5天）
1. 实现小鼠管理功能（增删改查）
2. 实现实验记录功能（增删改查）
3. 实现列表展示和搜索筛选
4. 实现小鼠详情页和时间轴

### 阶段三：数据可视化（第6天）
1. 集成Chart.js图表库
2. 实现体重变化曲线图
3. 实现数据统计图表

### 阶段四：导出功能（第7天）
1. 实现Excel导出功能
2. 实现PDF报告导出功能

### 阶段五：优化完善（第8天）
1. UI细节优化
2. 响应式适配
3. 性能优化
4. 测试和Bug修复

---

## 9. 附录

### 9.1 常见小鼠品系参考
- C57BL/6（最常用的近交系）
- BALB/c（免疫研究常用）
- ICR（封闭群，繁殖用）
- SD大鼠（Sprague-Dawley）
- Wistar大鼠
- KM小鼠（昆明小鼠）

### 9.2 常见实验类型
- 日常称重
- 给药（口服/注射）
- 行为学测试
- 采血
- 组织取样
- 解剖
- 影像学检查

### 9.3 给药途径
- 口服（PO）
- 皮下注射（SC）
- 腹腔注射（IP）
- 静脉注射（IV）
- 肌肉注射（IM）

---

**文档版本**：v1.0  
**创建日期**：2026-01-30  
**最后更新**：2026-01-30